-#=stylesheet_link_tag "http://cdn.leafletjs.com/leaflet/v0.7.7/leaflet.css"
-#=javascript_include_tag "http://cdn.leafletjs.com/leaflet/v0.7.7/leaflet.js"
=stylesheet_link_tag "leaflet/leaflet"
=javascript_include_tag "leaflet/leaflet"
=javascript_include_tag"https://api.tiles.mapbox.com/mapbox.js/plugins/leaflet-markercluster/v0.4.0/leaflet.markercluster.js"
= stylesheet_link_tag 'http://leaflet.github.io/Leaflet.markercluster/dist/MarkerCluster.Default.css'
= stylesheet_link_tag 'http://leaflet.github.io/Leaflet.markercluster/dist/MarkerCluster.css'
-#=javascript_include_tag "leaflet/leaflet.markercluster-src"
-#=javascript_include_tag "leaflet/leaflet.markercluster"
-#=stylesheet_link_tag "leaflet/MarkerCluster.Default"
-#=stylesheet_link_tag "leaflet/MarkerCluster"
:scss
  #map{
    height: 80%;
    //height: calc (100vh - 130px);
  }

#map

:javascript
    var markersLayer;
    var mymap = L.map('map').setView([49.23, 28.47], 9);

    L.tileLayer('https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token={accessToken}', {
        attribution: 'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, <a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery Â© <a href="http://mapbox.com">Mapbox</a>',
        maxZoom: 20,
        id: 'quicks.0hf3cla6',
        accessToken: 'pk.eyJ1IjoicXVpY2tzIiwiYSI6ImNpcTE1Z2xyYzAwMm1pMm0ybXFoMW1hdzAifQ.NQB9Oj5QISGyxJ9FTvNK3Q'
    }).addTo(mymap);

    // var geojsonMarkerOptions = {
    //   radius: 10,
    //   fillColor: "#ff7800",
    //   color: "#000",
    //   weight: 1,
    //   opacity: 1,
    //   fillOpacity: 0.8
    // };

    function onEachFeature(feature, layer) {
      if (feature.properties && feature.properties.title) {
            layer.bindPopup(feature.properties.title);
      }
    }
    function addMarkers(markers) {
      markersLayer = L.markerClusterGroup();
      var layer = L.geoJson(markers, {
         onEachFeature: onEachFeature,
        //   pointToLayer: function (feature, latlng) {
        //   return L.circleMarker(latlng, geojsonMarkerOptions);
        // }
      });
      markersLayer.addLayer(layer);
      mymap.addLayer(markersLayer);
    }

  $(document).ready(function(){
    $.ajax({
      url : '/geo_json_tender',
      dataType: 'JSON',
      success: function(data) {
        addMarkers(data);
       }
    })
  });

